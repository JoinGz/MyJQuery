<!DOCTYPE html>
<html lang="zh">

	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
		<title>Document</title>
		<script>
			//沙盒模式
			(function(w) {
				var version = "1.0.0";
				//定义主要jq函数
				function jQuery(selector) {
					//新建一个构造函数，jq就建在了构造函数的一个属性上
					//用这个返回生成一个实例，外面用的时候就不用每次都new;
					return new jQuery.fn.init(selector);
				}
				// 把jq.prototype简写一下
				jQuery.fn = jQuery.prototype = {
					constructor: jQuery,
					jquery: version,
					selector: "",
					length: 0,
					toArray: function() {
						//伪数组转换为数组方法
						return [].slice.call(this)
					},
					get: function(i) {
						//if(i == null){
						//return this.toArray();
						//}else if( i>=0){
						//	return this[i];
						//}else{
						//return this[this.length+i];
						//}
						return i == null ? this.toArray() : (i >= 0 ? this[i] : this[this.length + i])
					},
					each: function(fn) {
						return jQuery.each(this, fn);
					},
					map:function(fn){
						return jQuery.map(this, fn);
					},
					eq: function(i) {
						//if(i==null){
						//return jQuery();
						//}
						//return i>=0?jQuery(this[i]):jQuery(this[this.length+i]);
						return i == null ? jQuery() : jQuery(this.get(i));
					},
					first: function() {
						return this.eq(0);
					},
					last: function() {
						return this.eq(-1);
					},
					push: [].push,
					sort: [].sort,
					splice: [].splice

				}
				//给构造函数和原型链增加extend方法，用于增加方法
				jQuery.extend = jQuery.fn.extend = function(obj) {
					for(var key in obj) {
						this[key] = obj[key];
					}
				}
				//给jq构造函数的属性
				jQuery.extend({
					//这里的方法jq可以直接使用
					//传到原型链上的直接把对象传为this,就少传一个参数,其实也可以不用传。原型链就可以用了
					each: function(obj, fn) {
						var i, l, key;
						if("length" in obj) {
							for(i = 0, l = obj.length; i < l; i++) {
								if(fn.call(obj[i], i, obj[i]) === false) {
									break;
								}
								//fn(i,obj[i])
							}
						} else {
							for(key in obj) {
								if(fn.call(obj[key], key, obj[key]) === false) {
									break;
								}
							}
						}
						return obj;
					},
					map: function(obj, fn) {
						var i, l, key;
						var result = [];
						if("length" in obj) {
							for(i = 0, l = obj.length; i < l; i++) {
								result.push(fn.call(obj[i], i, obj[i]))
							}
						} else {
							for(key in obj) {
								result.push(fn.call(obj[key], key, obj[key]))
							}
						}
						return result;

					},
					slice: function() {
						return jQuery([].slice.apply(this, arguments))
					},

					isHtml: function(val) {
						if(!val) {
							return false;
						}
						if(val.charAt(0) === "<" &&
							val.charAt(val.length - 1) === '>' &&
							val.length >= 3) {
							return true;
						}
						return false;
					},
					isFunction: function(val) {
						return typeof val === "function";
					},
					isString: function(val) {
						return typeof val === "string";
					},
					isObj: function(val) {
						if(!val) {
							return false;
						}
						if(typeof val === "object" || typeof val === "function") {
							return true;
						}
						return false;
					},

					isArray: function(val) {
						if(jQuery.isFunction(val) || !jQuery.isObj(val) || jQuery.isWindow(val)) {
							return false;
						}
						if(({}).toString.call(val) === "[object Array]") {
							return true;
						}
						if("length" in val && (val.length === 0 || val.length - 1 in val)) {
							return true;
						}
						return false;
					},
					isWindow: function(val) {
						if(!val) {
							return false;
						}
						return val.window == val ? true : false;
					},
					ready: function(val) {
						if(document.readyState == "complete") {
							val();
						} else if(document.addEventListener) {
							document.addEventListener("DOMContentLoaded", val)
						} else {
							document.attachEvent("onreadystatechange", function() {
								if(document.readyState == "complete") {
									val();
								}
							})
						}

					}

				})
				var init = jQuery.fn.init = function(selector) {
					if(!selector) {
						return this;
					};
					if(jQuery.isString(selector)) {
						if(jQuery.isHtml(selector)) {
							var div = document.createElement("div");
							div.innerHTML = selector;
							[].push.apply(this, div.childNodes);
						} else {
							[].push.apply(this, document.querySelectorAll(selector));
						}
					} else if(jQuery.isArray(selector)) {
						[].push.apply(this, [].slice.call(selector))
					} else if(jQuery.isFunction(selector)) {
						jQuery.ready(selector)
					} else {
							this[0] = selector;
							this.length = 1;
					}
				}
				init.prototype = jQuery.fn;
				w.$ = w.jQuery = jQuery;
			}(window))
		</script>
		<script>
			$(function() {
				console.log($("a").toArray())
			})
		</script>
	</head>

	<body>
		<a href="">1</a>
		<a href="">2</a>
		<a href="">3</a>
		<a href="">4</a>

	</body>

</html>